function parallax(e){var t=document.querySelectorAll(".parallax");window.onscroll=function(){for(var a=0;a<t.length;a++){var n=$(t[a]).offset(),r=(window.height,window.pageYOffset/n.top),o=[0,-10,-60,-40,0,-20],s=[];s[a]="50% "+(o[a]+r*e)+"%",t[a].style.backgroundPosition=s[a]}}}function collapseNavbar(){$(".navbar").offset().top>50?$(".navbar-fixed-top").addClass("top-nav-collapse"):$(".navbar-fixed-top").removeClass("top-nav-collapse")}function BoldText(e){e!=currElem&&(currElem&&(currElem.style.fontWeight="lighter"),currElem=e,e.style.fontWeight="bolder")}function opioidsY2000(e,t){d3.select(".circle.opioids.y2015").attr("r",3).style("fill-opacity",.75).style("stroke-width","0"),d3.select(".circle.opioids.y2000").attr("r",15).style("fill-opacity",.9).style("stroke-width","0").style("stroke","#8e1014"),d3.select(".btn-bsas").classed("active",!0)}function opioidsY2015(e,t){d3.select(".circle.opioids.y2000").attr("r",3).style("fill-opacity",.75).style("stroke-width","0"),d3.select(".circle.opioids.y2015").attr("r",15).style("fill-opacity",.9).style("stroke-width","0").style("stroke","#8e1014"),d3.select(".btn-bsas").classed("active",!0)}function InitPxVideo(e){"use strict";function t(e){var t=[];return t=e.split(" --> "),n(t[0])}function a(e){var t=[];return t=e.split(" --> "),n(t[1])}function n(e){if(null===e||void 0===e)return 0;var t,a=[],n=[];return a=e.split(","),n=a[0].split(":"),t=Math.floor(60*n[0]*60)+Math.floor(60*n[1])+Math.floor(n[2])}function r(e){for(e.subcount=0;a(e.captions[e.subcount][0])<e.movie.currentTime.toFixed(1);)if(e.subcount++,e.subcount>e.captions.length-1){e.subcount=e.captions.length-1;break}}function o(e){e.captionsBtnContainer.className="px-video-captions-btn-container show-inline",e.isCaptionDefault&&(e.captionsContainer.className="px-video-captions show",e.captionsBtn.setAttribute("checked","checked"))}function s(){var e,t,a,n=(navigator.appVersion,navigator.userAgent),r=navigator.appName,o=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10);return navigator.appVersion.indexOf("Windows NT")!==-1&&navigator.appVersion.indexOf("rv:11")!==-1?(r="IE",o="11;"):(t=n.indexOf("MSIE"))!==-1?(r="IE",o=n.substring(t+5)):(t=n.indexOf("Chrome"))!==-1?(r="Chrome",o=n.substring(t+7)):(t=n.indexOf("Safari"))!==-1?(r="Safari",o=n.substring(t+7),(t=n.indexOf("Version"))!==-1&&(o=n.substring(t+8))):(t=n.indexOf("Firefox"))!==-1?(r="Firefox",o=n.substring(t+8)):(e=n.lastIndexOf(" ")+1)<(t=n.lastIndexOf("/"))&&(r=n.substring(e,t),o=n.substring(t+1),r.toLowerCase()==r.toUpperCase()&&(r=navigator.appName)),(a=o.indexOf(";"))!==-1&&(o=o.substring(0,a)),(a=o.indexOf(" "))!==-1&&(o=o.substring(0,a)),s=parseInt(""+o,10),isNaN(s)&&(o=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10)),[r,s]}function i(e){if(!(e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement)){var t=e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen;t.call(e)}}function l(){document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?(p.fullScreenBtn.checked=!0,p.container.className=p.container.className="px-video-container fullscreen",p.controls.className="px-video-controls js-fullscreen-controls",p.captionsContainer.className="px-video-captions js-fullscreen-captions",p.movie.setAttribute("width","100%"),p.movie.setAttribute("height","100%")):(p.fullScreenBtn.checked=!1,p.container.className=p.container.className="px-video-container",p.controls.className="px-video-controls",p.captionsContainer.className="px-video-captions",p.movie.setAttribute("width",p.movieWidth),p.movie.setAttribute("height",p.movieHeight))}function c(){var e=document.exitFullscreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen;e.call(document)}function d(e){var t=document.getElementById("px-video-aria-announce");t&&(t.innerHTML="<p>"+e+"</p>")}function u(){p.video.src=p.container.getElementsByTagName("source")[0].getAttribute("src"),p.isTextTracks||(p.subcount=0),p.movie.currentTime=0,p.movie.pause(),p.btnPlay.className="px-video-play px-video-show-inline",p.btnPause.className="px-video-pause hide"}!function(){var e=document.createElement("div");e.id="px-video-aria-announce",e.setAttribute("role","alert"),e.setAttribute("aria-atomic","true"),e.style.overflow="hidden",e.style.textIndent="-999999px",document.body.appendChild(e)}();var p={};if(p.arBrowserInfo=s(),p.browserName=p.arBrowserInfo[0],p.browserMajorVersion=p.arBrowserInfo[1],"IE"===p.browserName&&(8===p.browserMajorVersion||9===p.browserMajorVersion))return!1;if(p.isSmartphoneOrTablet=/webOS|iPhone|iPad|iPod/i.test(navigator.userAgent),p.isSmartphoneOrTablet)return!1;"undefined"==typeof e.debug&&(e.debug=!1),p.debug=e.debug,e.debug&&console.log(p.browserName+" "+p.browserMajorVersion),"undefined"==typeof e.videoTitle||""===e.videoTitle?p.playAriaLabel="Play":p.playAriaLabel="Play video, "+e.videoTitle,p.container=document.getElementById(e.videoId),p.movie=p.container.getElementsByTagName("video")[0],p.controls=p.container.getElementsByClassName("px-video-controls")[0],p.movie.removeAttribute("controls"),p.randomNum=Math.floor(1e4*Math.random()),e.debug&&console.log("Inserting custom video controls"),p.controls.innerHTML='<progress class="px-video-progress" max="100" value="0"><span>0</span>% played</progress><div class="controls-left"><button class="px-video-restart" title="'+GLOBAL_STRINGS.RESTART+'"><span class="sr-only">'+GLOBAL_STRINGS.RESTART+'</span></button><button class="px-video-rewind" title="'+GLOBAL_STRINGS.REWIND+'"><span class="sr-only">rewind <span class="px-seconds">10</span> seconds</span></button><button class="px-video-play" aria-label="'+p.playAriaLabel+'" title="'+GLOBAL_STRINGS.PLAY+'"><span class="sr-only">'+GLOBAL_STRINGS.PLAY+'</span></button><button class="px-video-pause hide" title="'+GLOBAL_STRINGS.PAUSE+'"><span class="sr-only">'+GLOBAL_STRINGS.PAUSE+'</span></button><button class="px-video-forward" title="'+GLOBAL_STRINGS.FORWARD+'""><span class="sr-only">forward <span class="px-seconds">10</span> seconds</span></button></div><div class="controls-right"><div class="px-video-mute-btn-container" title="'+GLOBAL_STRINGS.MUTE+'"><input class="px-video-mute sr-only" id="btnMute'+p.randomNum+'" type="checkbox" /><label id="labelMute'+p.randomNum+'" for="btnMute'+p.randomNum+'"><span class="sr-only">'+GLOBAL_STRINGS.MUTE+'</span></label></div><label for="volume'+p.randomNum+'" class="sr-only">Volume:</label><input id="volume'+p.randomNum+'" class="px-video-volume" type="range" min="0" max="10" value="5" /><div class="px-video-captions-btn-container hide" title="'+GLOBAL_STRINGS.CAPTIONS+'"><input class="px-video-btnCaptions sr-only" id="btnCaptions'+p.randomNum+'" type="checkbox" /><label for="btnCaptions'+p.randomNum+'"><span class="sr-only">'+GLOBAL_STRINGS.CAPTIONS+'</span></label></div><div class="px-video-fullscreen-btn-container show-inline" title="'+GLOBAL_STRINGS.TOGGLE_FULL_SCREEN+'"><input class="px-video-btnFullScreen sr-only" id="btnFullscreen'+p.randomNum+'" type="checkbox" /><label for="btnFullscreen'+p.randomNum+'"><span class="sr-only">'+GLOBAL_STRINGS.TOGGLE_FULL_SCREEN+'</span></label></div><div class="px-video-time"><span class="sr-only">time</span> <span class="px-video-duration">00:00</span></div></div></div></div>';for(var h,m="",f=p.movie.childNodes,v=0;v<f.length;v++)"track"===f[v].nodeName.toLowerCase()&&(h=f[v].getAttribute("kind"),"captions"===h&&(m=f[v].getAttribute("src")));if(p.captionExists=!0,""===m?(p.captionExists=!1,e.debug&&console.log("No caption track found.")):e.debug&&console.log("Caption track found; URI: "+m),"undefined"==typeof e.captionsOnDefault&&(e.captionsOnDefault=!0),p.isCaptionDefault=e.captionsOnDefault,"undefined"==typeof e.seekInterval&&(e.seekInterval=10),p.seekInterval=e.seekInterval,p.video=p.container.getElementsByTagName("video")[0],p.btnPlay=p.container.getElementsByClassName("px-video-play")[0],p.btnPause=p.container.getElementsByClassName("px-video-pause")[0],p.btnRestart=p.container.getElementsByClassName("px-video-restart")[0],p.btnRewind=p.container.getElementsByClassName("px-video-rewind")[0],p.btnForward=p.container.getElementsByClassName("px-video-forward")[0],p.btnVolume=p.container.getElementsByClassName("px-video-volume")[0],p.btnMute=p.container.getElementsByClassName("px-video-mute")[0],p.progressBar=p.container.getElementsByClassName("px-video-progress")[0],p.progressBarSpan=p.progressBar.getElementsByTagName("span")[0],p.captionsContainer=p.container.getElementsByClassName("px-video-captions")[0],p.captionsBtn=p.container.getElementsByClassName("px-video-btnCaptions")[0],p.captionsBtnContainer=p.container.getElementsByClassName("px-video-captions-btn-container")[0],p.duration=p.container.getElementsByClassName("px-video-duration")[0],p.txtSeconds=p.container.getElementsByClassName("px-seconds"),p.fullScreenBtn=p.container.getElementsByClassName("px-video-btnFullScreen")[0],p.fullScreenBtnContainer=p.container.getElementsByClassName("px-video-fullscreen-btn-container")[0],p.txtSeconds[0].innerHTML=p.seekInterval,p.txtSeconds[1].innerHTML=p.seekInterval,p.isTextTracks=!1,p.movie.textTracks&&(p.isTextTracks=!0),p.movie.addEventListener("ended",u,!1),p.btnPlay.addEventListener("click",function(){p.movie.play(),p.btnPlay.className="px-video-play hide",p.btnPause.className="px-video-pause px-video-show-inline",p.btnPause.focus()},!1),$(window).width()>991&&$(".js-play-video").click(function(e){var t=$(e.target).data("target");console.log(t);var a=document.getElementById(t),n=a.getElementsByTagName("video")[0],r=a.getElementsByClassName("px-video-play")[0],o=a.getElementsByClassName("px-video-pause")[0];n.play(),r.className="px-video-play hide",o.className="px-video-pause px-video-show-inline"}),p.btnPause.addEventListener("click",function(){p.movie.pause(),p.btnPlay.className="px-video-play px-video-show-inline",p.btnPause.className="px-video-pause hide",p.btnPlay.focus()},!1),p.btnRestart.addEventListener("click",function(){p.movie.currentTime=0,p.isTextTracks||(p.subcount=0),p.movie.play(),p.btnPlay.className="px-video-play hide",p.btnPause.className="px-video-pause px-video-show-inline"},!1),p.btnRewind.addEventListener("click",function(){var e=p.movie.currentTime-p.seekInterval;e<0?p.movie.currentTime=0:p.movie.currentTime=e,p.isTextTracks||r(p);var t=Math.round(e)>0?Math.round(e):0,a="rewind to "+t+" seconds";d(a)},!1),p.btnForward.addEventListener("click",function(){var e=p.movie.currentTime+p.seekInterval;e>p.movie.duration?p.movie.currentTime=p.movie.duration:p.movie.currentTime=e,p.isTextTracks||r(p);var t="forward to "+Math.round(e)+" seconds";d(t)},!1),p.btnVolume.addEventListener("change",function(){p.movie.volume=parseFloat(this.value/10)},!1),p.btnMute.addEventListener("click",function(){p.movie.muted===!0?p.movie.muted=!1:p.movie.muted=!0},!1),p.btnMute.onkeypress=function(e){13==e.keyCode&&(e.preventDefault(),1==this.checked?this.checked=!1:this.checked=!0,p.movie.muted===!0?p.movie.muted=!1:p.movie.muted=!0)},p.movie.addEventListener("timeupdate",function(){p.secs=parseInt(p.movie.currentTime%60),p.mins=parseInt(p.movie.currentTime/60%60),p.secs=("0"+p.secs).slice(-2),p.mins=("0"+p.mins).slice(-2),p.duration.innerHTML=p.mins+":"+p.secs},!1),p.movie.addEventListener("timeupdate",function(){p.percent=100/p.movie.duration*p.movie.currentTime,p.percent>0&&(p.progressBar.value=p.percent,p.progressBarSpan.innerHTML=p.percent)},!1),p.progressBar.addEventListener("click",function(e){p.pos=e.offsetX/this.offsetWidth,p.movie.currentTime=p.pos*p.movie.duration,p.isTextTracks||r(p)}),p.fullScreenBtn.addEventListener("click",function(){this.checked?i(p.container):c()},!1),p.fullScreenBtn.onkeypress=function(e){13==e.keyCode&&(e.preventDefault(),1==this.checked?(this.checked=!1,c()):(this.checked=!0,i(p.container)))},p.movie.addEventListener("ended",function(){p.captionsContainer.innerHTML=""}),p.captionsBtn.addEventListener("click",function(){if(this.checked?p.captionsContainer.className="px-video-captions show-inline":p.captionsContainer.className="px-video-captions hide",document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement){var e=p.captionsContainer.className;p.captionsContainer.className=e+" js-fullscreen-captions"}},!1),p.captionsBtn.onkeypress=function(e){13==e.keyCode&&(e.preventDefault(),1==this.checked?this.checked=!1:this.checked=!0,this.checked?p.captionsContainer.className="px-video-captions show-inline":p.captionsContainer.className="px-video-captions hide")},p.captionExists){if("IE"===p.browserName&&10===p.browserMajorVersion||"IE"===p.browserName&&11===p.browserMajorVersion||"Firefox"===p.browserName&&p.browserMajorVersion>=31||"Chrome"===p.browserName&&43===p.browserMajorVersion||"Safari"===p.browserName&&p.browserMajorVersion>=7){e.debug&&console.log("Detected browser unable to play HTML5 captions; using custom captions"),p.isTextTracks=!1;for(var g={},b=p.movie.textTracks,y=0;y<b.length;y++)g=p.movie.textTracks[y],g.mode="hidden"}if(p.isTextTracks){e.debug&&console.log("textTracks supported"),o(p);for(var g={},b=p.movie.textTracks,y=0;y<b.length;y++)g=p.movie.textTracks[y],g.mode="hidden","captions"===g.kind&&g.addEventListener("cuechange",function(){this.activeCues[0]&&(this.activeCues[0].hasOwnProperty("text")||""!==this.activeCues[0].text)&&(p.captionsContainer.innerHTML=this.activeCues[0].text)},!1)}else if(e.debug&&console.log("textTracks not supported so rendering captions 'manually'"),o(p),p.currentCaption="",p.subcount=0,p.captions=[],p.movie.addEventListener("timeupdate",function(){p.movie.currentTime.toFixed(1)>t(p.captions[p.subcount][0])&&p.movie.currentTime.toFixed(1)<a(p.captions[p.subcount][0])&&(p.currentCaption=p.captions[p.subcount][1]),p.movie.currentTime.toFixed(1)>a(p.captions[p.subcount][0])&&p.subcount<p.captions.length-1&&p.subcount++,p.captionsContainer.innerHTML=p.currentCaption},!1),""!=m){var x;window.XMLHttpRequest?x=new XMLHttpRequest:window.ActiveXObject&&(x=new ActiveXObject("Microsoft.XMLHTTP")),x.onreadystatechange=function(){if(4===x.readyState)if(200===x.status){e.debug&&console.log("xhr = 200"),p.captions=[];var t,a=[],n=x.responseText;a=n.split("\n\n");for(var r=0;r<a.length;r++)t=a[r],p.captions[r]=[],p.captions[r]=t.split("\n");p.captions.shift(),e.debug&&console.log("Successfully loaded the caption file via ajax.")}else e.debug&&console.log("There was a problem loading the caption file via ajax.")},x.open("get",m,!0),x.send()}if("Safari"===p.browserName&&7===p.browserMajorVersion){console.log("Safari 7 detected; removing track from DOM");var b=p.movie.getElementsByTagName("track");p.movie.removeChild(b[0])}}else p.captionsContainer.className="px-video-captions hide";document.addEventListener("fullscreenchange",function(){l()},!1),document.addEventListener("mozfullscreenchange",function(){l()},!1),document.addEventListener("webkitfullscreenchange",function(){l()},!1),document.addEventListener("MSFullscreenChange",function(){l()},!1)}!function(){function e(e){function n(){for(;i=d<c.length&&u<e;){var t=d++,n=c[t],o=a.call(n,1);o.push(r(t)),++u,n[0].apply(null,o)}}function r(e){return function(t,a){--u,null==h&&(null!=t?(h=t,d=p=NaN,o()):(c[e]=a,--p?i||n():o()))}}function o(){null!=h?m(h):l?m(h,c):m.apply(null,[h].concat(c))}var s,i,l,c=[],d=0,u=0,p=0,h=null,m=t;return e||(e=1/0),s={defer:function(){return h||(c.push(arguments),++p,n()),s},await:function(e){return m=e,l=!1,p||o(),s},awaitAll:function(e){return m=e,l=!0,p||o(),s}}}function t(){}var a=[].slice;e.version="1.0.7","function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof module&&module.exports?module.exports=e:this.queue=e}(),document.createElement("article"),document.createElement("section");var speed=-80;parallax(speed),$(window).scroll(collapseNavbar),$(document).ready(collapseNavbar),$(function(){$("a.page-scroll").bind("click",function(e){e.preventDefault();var t=$(this).attr("href");$("html, body").stop().animate({scrollTop:$(t).offset().top},750,function(){window.location.hash=t}),e.preventDefault()})}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var t=$(e.target).attr("href"),a=document.querySelector(t).clientHeight;$(t).parent().animate({height:a})}),$(".navbar-collapse ul li a").click(function(){"dropdown-toggle active"!=$(this).attr("class")&&"dropdown-toggle"!=$(this).attr("class")&&$(".navbar-toggle:visible").click()}),$(window).scroll(function(){$(window).scrollTop()>=400?$("#navigation").addClass("navbar-fixed-top"):$("#navigation").removeClass("navbar-fixed-top"),$(".target").each(function(){if($(window).scrollTop()>=$(this).offset().top-10){var e=$(this).attr("id");$("#navigation li").removeClass("active"),$("#navigation li[id="+e+"1]").addClass("active");var t=$(this).attr("data-index");$("#current-section").html(t)}})}),$("#navigation li").on("click",function(){$(this).parent().find("li").removeClass("active"),$(this).addClass("active")}),$(".pills-first a").click(function(e){e.preventDefault(),$(this).tab("show")}),$(function(){$("#odInfographic").load("img/human1.svg",function(e){function t(e){$(".btn-svg").removeClass("active"),$('.btn-svg[value="'+e+'"]').addClass("active"),"1/12"==e?($(".svg-studyperiod").attr("opacity",0),$(".svg-onemonth").attr("opacity",1),$("#odInfographic_details").html("Only about <strong>1 in 12</strong> people who died from opioids in 2013 and 2014 had an active opioid prescription in the month before they died")):($(".svg-studyperiod").attr("opacity",1),$("#odInfographic_details").html("About <strong>8 in 12</strong> people who died from opioids in 2013 and 2014 had an opioid prescription at some point from 2011–2014"))}var a=($(this).find("svg"),"2/3");t(a),$(".btn-svg").on("click",function(){t($(this).val())}),$(".controls-svg").on("click",function(){t($(this).data("select"))})})}),$("p, .sources-section li, .tab-pane li").each(function(){var e=$(this).html(),t=e.trim().split(" ");if(t.length>2){var a=t[t.length-1],n=t.slice(0,-1).join(" ");$(this).html(n+"&nbsp;"+a)}});var currElem=null,Vis=function(e){"use strict";function t(e,t,n){n.data.forEach(function(e,n){var o=r.append("div").attr("class","map-wrapper").append("div");a(o,t,e)})}function a(t,a,n){function r(t,a){e.selectAll(t)[0].forEach(function(t,n){var r=e.select(t);r.on(a)(r)})}t.append("span").text(function(e){return 2005==n.key?"2001 to 2005":2010==n.key?"2006 to 2010":2015==n.key?"2011 to 2015":void 0}).attr("class","vis-title").style("padding-bottom","44%").style("padding-left","14%"),t.append("span").text("").attr("class","selection-label");var i=t.classed("svg-container",!0).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+o+" "+s).style("padding-top","2%").classed("svg-content-responsive",!0);i.selectAll("path").data(a.features).enter().append("path").attr("d",l).style("stroke","white").style("stroke-width","0.0px").style("fill",function(e,t){var a=n.values[e.properties.TOWN];return c(a)}).on("mouseover",function(e,t){}).on("mouseout",function(e,t){}).attr("class",function(e){return e.properties.TOWN.toLowerCase()+" bsasmap"}).on("mouseenter",function(e,t){r("."+e.properties.TOWN.toLowerCase(),"select")}).on("mouseleave",function(e){r("."+e.properties.TOWN.toLowerCase(),"unselect")}).on("select",function(t){var a,r,o=t.data();n.values[o[0].properties.TOWN]>0&&1==n.population[o[0].properties.TOWN]?(r=n.population[o[0].properties.TOWN],a=e.format(".1f")(n.values[o[0].properties.TOWN]),t.node().parentNode.parentNode.getElementsByClassName("selection-label")[0].innerHTML=o[0].properties.TOWN_1+"<br> Five-year death count: "+r+"<br> Death rate per 100,000 people: "+a):n.values[o[0].properties.TOWN]>0&&n.population[o[0].properties.TOWN]>1?(r=n.population[o[0].properties.TOWN],a=e.format(".1f")(n.values[o[0].properties.TOWN]),t.node().parentNode.parentNode.getElementsByClassName("selection-label")[0].innerHTML=o[0].properties.TOWN_1+"<br> Five-year death count: "+r+"<br> Death rate per 100,000 people: "+a):0==n.values[o[0].properties.TOWN]&&0==n.population[o[0].properties.TOWN]?(a="0",r="0",t.node().parentNode.parentNode.getElementsByClassName("selection-label")[0].innerHTML=o[0].properties.TOWN_1+"<br> Five-year death count: "+r+"<br> Death rate per 100,000 people: "+a):n.values[o[0].properties.TOWN]<0&&n.population[o[0].properties.TOWN]>0&&(a="N/A",r=n.population[o[0].properties.TOWN],t.node().parentNode.parentNode.getElementsByClassName("selection-label")[0].innerHTML=o[0].properties.TOWN_1+"<br> Five-year death count: "+r+"<br> Death rate per 100,000 people: "+a),e.select(t.node()).style("fill-opacity",.4).style("stroke","white").style("stroke-width","1.5px")}).on("unselect",function(t){t.node().parentNode.parentNode.getElementsByClassName("selection-label")[0].innerHTML="",e.selectAll("path.bsasmap").style({"fill-opacity":1}).style("stroke","white").style("stroke-width","0.0px")})}function n(t,a,n){var r=60,o="90%",s=e.select("#"+a).append("svg").attr("width",o).attr("height",r),i=s.append("g"),l=[];l.push({d:-9999,r:"#f1f1f1",s:"N/A"});var c;for(c=0;c<t.domain().length;c++)l.push({d:t.domain()[c],r:t.range()[c],s:t.domainStrings()[c]});var d=100/l.length;i.selectAll("rect").data(l).enter().append("rect").attr("height",r/3).attr("width",function(e,t){return d+"%"}).attr("x",function(e,t){return t*d+"%"}).attr("y",20).style("stroke","black").style("stroke-width","0.25px").style("fill",function(e,t){return e.r}),i.selectAll("text").data(l).enter().append("text").attr("text-anchor","middle").attr("x",function(e,t){return t*d+d/2+"%"}).attr("y",55).text(function(e,t){return e.s}),i.append("text").attr("class","vis-caption").attr("y",12).text(n)}var r=e.select("#binaryMaps_maps");queue().defer(e.json,"js/data/TOWN.geo.json").defer(e.json,"js/data/rate_5yr_odc.json").await(t);var o=525,s=325,i=e.geo.conicConformal().parallels([41+43/60,42+41/60]).rotate([71.5,-41]).scale([8600]).translate([280,360]),l=(e.select("#carte").append("svg").attr("width",o).attr("height",s),e.geo.path().projection(i)),c=e.scale.threshold().domain([-.1,.1,2.1,6.1,17.1,1/0]).range(["#f1f1f1","#d3d3d3","#9ecae1","#6baed6","#2171b5","#084594"]),d=e.scale.threshold().domain([.1,2.1,6.1,17.1,1/0]).range(["#d3d3d3","#9ecae1","#6baed6","#2171b5","#084594"]);d.domainStrings=function(){return["0",">0-2.1",">2.1-6.1",">6.1-17.1",">17.1"]},n(d,"binaryMaps_legend","Rate per 100,000 People"),$(".js-toggle-binary-map").click(function(){var e=$(this).data("date");$("#binaryMaps").attr("data-active-date",e),$(".js-toggle-binary-map").removeClass("active"),$(this).addClass("active")})}(d3);console.log("file loaded - binary");var Vis=function(e){"use strict";function t(e,t,n){n.data.forEach(function(e,n){var o=r.append("div").attr("class","map-wrapper").append("div");a(o,t,e)})}function a(t,a,n){function r(t,a){e.selectAll(t)[0].forEach(function(t,n){var r=e.select(t);r.on(a)(r)})}t.append("span").text(n.key).attr("class","vis-title"),t.append("span").text("").attr("class","selection-label");var i=t.classed("svg-container",!0).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+o+" "+s).classed("svg-content-responsive",!0);i.selectAll("path").data(a.features).enter().append("path").attr("d",l).style("stroke","white").style("stroke-width","0.0px").style("fill",function(e,t){var a=n.values[e.properties.TOWN];return c(a)}).on("mouseover",function(e,t){}).on("mouseout",function(e,t){}).attr("class",function(e){return e.properties.TOWN.toLowerCase()+" bsasmap"}).on("mouseenter",function(e,t){r("."+e.properties.TOWN.toLowerCase(),"select")}).on("mouseleave",function(e){r("."+e.properties.TOWN.toLowerCase(),"unselect")}).on("select",function(t){var a,r=t.data();a=n.values[r[0].properties.TOWN]>=0?e.format("%,.2f")(n.values[r[0].properties.TOWN]):"N/A",t.node().parentNode.parentNode.getElementsByClassName("selection-label")[0].innerHTML=r[0].properties.TOWN_1+":  "+a,e.select(t.node()).style("fill-opacity",.4).style("stroke","white").style("stroke-width","1.5px")}).on("unselect",function(t){t.node().parentNode.parentNode.getElementsByClassName("selection-label")[0].innerHTML="",e.selectAll("path.bsasmap").style({"fill-opacity":1}).style("stroke","white").style("stroke-width","0.0px")})}function n(t,a,n){var r=70,o=e.select("#"+a).append("svg").attr("width","100%").attr("height",r),s=o.append("g"),i=[];i.push({d:-9999,r:"#dbdbdb",s:"N/A"});var l;for(l=0;l<t.domain().length;l++)i.push({d:t.domain()[l],r:t.range()[l],s:t.domainStrings()[l]});s.selectAll("rect").data(i).enter().append("rect").attr("height",20).attr("width",60).attr("x",function(e,t){return t*(100/i.length)+"%"}).attr("y",20).style("stroke","black").style("stroke-width","0.25px").style("fill",function(e,t){return e.r}),s.selectAll("text").data(i).enter().append("text").attr("text-anchor","middle").attr("x",function(e,t){return t*(100/i.length)+7+"%"}).attr("y",55).text(function(e,t){return e.s}),s.append("text").attr("class","vis-caption").attr("y",12).text(n)}var r=e.select("#treatmentMaps_maps");queue().defer(e.json,"js/data/TOWN.geo.json").defer(e.json,"js/data/maps_susbtance_data.json").await(t);var o=525,s=325,i=e.geo.conicConformal().parallels([41+43/60,42+41/60]).rotate([71.5,-41]).scale([7500]).translate([280,330]),l=(e.select("#carte").append("svg").attr("width",o).attr("height",s),e.geo.path().projection(i)),c=e.scale.threshold().domain([-.1,.01,.14,.24,.33,.46,1.1]).range(["#dbdbdb","#BCBEDC","#91ADD3","#67a9cf","#3690c0","#02818a","#016450"]),d=e.scale.threshold().domain([0,.1,.15,.35,.6,1]).range(["#BCBEDC","#91ADD3","#67a9cf","#3690c0","#02818a","#016450"]);d.domainStrings=function(){return["0%",">0-14%",">14-24%",">24-33%",">33-46%",">46-100%"]},n(d,"treatmentMaps_legend","Heroin Primary Substance of Abuse upon Seeking Treatment (%)"),$(".js-toggle-treatment-map").click(function(){var e=$(this).data("date");$("#treatmentMaps").attr("data-active-date",e),$(".js-toggle-treatment-map").removeClass("active"),$(this).addClass("active")})}(d3);!function(){"use strict";function e(e){var t=d3.keys(e[0]).slice(0,65),a=[];e.forEach(function(e,n){var r=[];t.forEach(function(t){e[t]&&r.push({year:t,rate:e[t],Geography:e.Geography,FullName:e.FullName})}),a.push({Geography:e.Geography,FullName:e.FullName,rates:r})}),e.dataset=a,h.domain(d3.extent(t,function(e){return p.parse(e)})),m.domain([d3.max(a,function(e){return d3.max(e.rates,function(e){return+e.rate})}),0]);var i=b.selectAll("g.lines-death").data(a).enter().append("g").attr("class","lines-death");s=i.selectAll("path").data(function(e){return[e.rates]}).enter().append("path").attr("class","line-death").classed("massachusetts",function(e,t){return $.inArray(e[t].Geography,d)!==-1}).classed("usa",function(e,t){return $.inArray(e[t].Geography,u)!==-1}),d3.selectAll("g.lines-death").on("mouseover",r).on("mouseout",n).on("mousemove",o)}function t(){c.width=l.clientWidth,c.width<500?c.margin.left=30:c.margin.left=50}function a(){t(),b.attr("width",c.width),h.range([c.margin.left,c.width-c.margin.right-c.margin.left]),m.range([c.margin.top,c.height-c.margin.bottom-c.margin.top]),f.scale(h).orient("bottom").ticks(c.width<700?8:15).tickFormat(function(e){return p(e)}).innerTickSize([8]),v.scale(m).orient(c.width<500?"right":"left").innerTickSize([8]),x.attr("x",(c.width-c.margin.left)/2),k.attr("y",-c.margin.left),c.width<500?w.attr("transform","translate("+c.margin.left+",0)"):w.attr("transform","translate("+c.margin.left+",0)"),g.x(function(e){return h(p.parse(e.year))}).y(function(e){return m(+e.rate)}).defined(function(e){return m(+e.rate)}),y.call(f),w.call(v),N.attr("x",c.width-c.margin.left-15).attr("y",m(23.8)-6),A.attr("x",c.width-c.margin.left-45).attr("y",m(10)-6),s.attr("d",g),C.append("circle").style("stroke-width",1).attr("r",6).attr("pointer-events","none")}function n(){d3.selectAll("path.line").classed("unfocused",!1).classed("focused",!1),d3.selectAll("path.point").classed("unfocused",!1).classed("focused",!1).attr("d",d3.svg.symbol().type("circle").size(15)).style("fill-opacity","1"),S.classed("hidden",!0),C.classed("hidden",!0)}function r(e,t){d3.selectAll("path.line").classed("unfocused",!0),d3.selectAll("path.point").classed("unfocused",!0).attr("d",d3.svg.symbol().type("circle").size(10)).style("fill-opacity","0"),d3.select(this).select("path.line").classed("unfocused",!1).classed("focused",!0);var a=(d3.mouse(this)[0],d3.mouse(this)[1]),n=m.invert(a),r=d3.format(".1f")(n);S.classed("hidden",!1).html(r),C.classed("hidden",!1)}function o(e){var t=d3.mouse(this)[0],a=d3.mouse(this)[1],n=m.invert(a),r=(h.invert(t),d3.format(".1f")(n));C.attr("transform","translate("+t+","+a+")"),c.width<555?S.style("top",d3.event.offsetY+60+"px").style("left",d3.event.offsetX+"px").html(r):S.style("top",d3.event.offsetY+30+"px").style("left",d3.event.offsetX+"px").html(r)}var s,i="#deathLines",l=document.querySelector(i),c={margin:{top:20,right:20,bottom:20,left:50},width:l.clientWidth,height:350},d=["MA"],u=["USA"],p=d3.time.format("%Y"),h=d3.time.scale(),m=d3.scale.linear(),f=d3.svg.axis(),v=d3.svg.axis(),g=d3.svg.line(),b=d3.select(i).append("svg").attr("width",c.width).attr("height",c.height),y=b.append("g").attr("class","vis-x-axis").attr("transform","translate(0,"+(c.height-c.margin.bottom-c.margin.top)+")").call(f),x=y.append("text").attr("x",(c.width-c.margin.left)/2).attr("y",c.margin.bottom).attr("dy","1em").attr("class","vis-x-axis-label").text("Year"),w=b.append("g").attr("class","vis-y-axis").attr("transform","translate("+c.margin.left+",0)").call(v),k=w.append("text").attr("x",-(c.height/2)).attr("y",-c.margin.left).attr("dy","1em").attr("class","vis-y-axis-label").text("Age-Adjusted Opioid-related Death Rate per 100,000 People"),N=b.append("text").attr("class","aside-ma").attr("x",c.width-c.margin.left-15).attr("y",m(23.8)-6).attr("dy","1em").style("text-anchor","start").text("MA"),A=b.append("text").attr("class","aside-usa").attr("x",c.width-c.margin.left-45).attr("y",m(10)-6).attr("dy","1em").style("text-anchor","start").text("USA"),S=d3.select("#deathLines").append("div").attr("class","vis-tooltip hidden"),C=b.append("g").attr("class","focus").classed("hidden",!0);d3.csv("js/data/death_states.csv",function(t){e(t),a(),window.addEventListener("resize",a)})}(),function(){"use strict";function e(e){var t=new Date;t.setMonth(e.getMonth()-10);var a=Math.ceil(t.getMonth()/3);return"Q"+a}function t(){d3.selectAll("path.line").classed("unfocused",!1).classed("focused",!1),d3.selectAll("path.point").classed("unfocused",!1).classed("focused",!1).attr("d",d3.svg.symbol().type("circle").size(15)).style("fill-opacity","1"),W.classed("hidden",!0),X.classed("hidden",!0)}function a(e,t){d3.selectAll("path.line").classed("unfocused",!0),d3.selectAll("path.point").classed("unfocused",!0).attr("d",d3.svg.symbol().type("circle").size(10)).style("fill-opacity","0"),d3.select(this).select("path.line").classed("unfocused",!1).classed("focused",!0);var a=(d3.mouse(this)[0],d3.mouse(this)[1]),n=S.invert(a),r=d3.format(".0%")(n);W.classed("hidden",!1).html(r),X.classed("hidden",!1)}function n(e){var t=d3.mouse(this)[0],a=d3.mouse(this)[1],n=S.invert(a),r=d3.format(".0%")(n);X.attr("transform","translate("+t+","+a+")"),W.style("top",d3.event.pageY-45+"px").style("left",d3.event.pageX+5+"px").html(r)}function r(){o(l.clientWidth),N.rangePoints([0,w]),A.rangePoints([0,w]),S.range([k,0]),_.scale(N),E.scale(N),O.scale(S),H.x(function(e){return N(e.label)}).y(function(e){return S(e.value)}),R.attr("transform","translate(0,"+k+")").call(_),G.attr("transform","translate(0,"+(k+15)+")").call(E),Y.attr("x",(w-b.left)/2).attr("y",b.bottom-32),V.call(O),D.attr("width",y).attr("height",x),q.attr("d",function(e){return H(e.values)}),U.attr("d",function(e){return H(e.values)}),Q.attr("class","vis-legend").attr("transform","translate("+(w-8*b.right)+",0)")}function o(e){
y=e,w=y-b.left-b.right,k=x-b.top-b.bottom}function s(){var e=["FentanylHeroin","Fentanyl","Heroin","Methadone"],t=["Both Fentanyl & Heroin","Only Fentanyl","Only Heroin","Only Methadone"];Q.attr("class","vis-legend").attr("transform","translate("+(w-8*b.right)+",0)");var a=15;e.forEach(function(e,n){K=Q.append("g").attr("class","legend-item-"+e).attr("transform","translate(0,"+n*a+")"),K.append("svg:line").attr("class","legend-item-"+e).attr("x1",0).attr("y1",5).attr("x2",30).attr("y2",5).style("stroke",u[n]).style("stroke-dasharray",h[n]).style("stroke-width",p[n]),K.append("text").attr("class","legend-item-"+e).attr("x",40).attr("y",10).text(t[n])})}var i="#fentanyl-lines",l=document.querySelector("#fentanyl-lines"),c=[{date:new Date("01/01/2014"),FentanylHeroin:"0.19",Fentanyl:"0.22",Heroin:"0.41",Methadone:"0.10"},{date:new Date("04/01/2014"),FentanylHeroin:"0.18",Fentanyl:"0.19",Heroin:"0.49",Methadone:"0.07"},{date:new Date("07/01/2014"),FentanylHeroin:"0.14",Fentanyl:"0.14",Heroin:"0.53",Methadone:"0.10"},{date:new Date("10/01/2014"),FentanylHeroin:"0.22",Fentanyl:"0.27",Heroin:"0.35",Methadone:"0.06"},{date:new Date("01/01/2015"),FentanylHeroin:"0.19",Fentanyl:"0.40",Heroin:"0.30",Methadone:"0.04"},{date:new Date("04/01/2015"),FentanylHeroin:"0.24",Fentanyl:"0.38",Heroin:"0.29",Methadone:"0.05"},{date:new Date("07/01/2015"),FentanylHeroin:"0.19",Fentanyl:"0.40",Heroin:"0.30",Methadone:"0.06"},{date:new Date("10/01/2015"),FentanylHeroin:"0.22",Fentanyl:"0.43",Heroin:"0.24",Methadone:"0.05"},{date:new Date("01/01/2016"),FentanylHeroin:"0.15",Fentanyl:"0.50",Heroin:"0.17",Methadone:"0.04"}],d=d3.time.format("%Y"),u=["#333333","#b71c1c","#0071bc","#333333"],p=["1.5px","3.5px","3.5px","2px"],h=["10,10,10,10","","","2,6,0,0"],m=["circle","circle","circle","circle"],f=["1px","1.5px","1.5px","1px"],v=["#a50f15","#08519c","#636363","#636363"],g="date",b={top:10,right:15,bottom:50,left:42},y=540,x=400,w=y-b.left-b.right,k=x-b.top-b.bottom,N=d3.scale.ordinal().rangePoints([0,w]),A=d3.scale.ordinal().rangePoints([0,w]),S=d3.scale.linear().range([k,0]),C=d3.scale.ordinal().range(u),B=d3.scale.ordinal().range(p),T=d3.scale.ordinal().range(h),$=d3.scale.ordinal().range(m),M=d3.scale.ordinal().range(f),F=d3.scale.ordinal().range(v),_=d3.svg.axis().scale(N).orient("bottom").ticks(d3.time.months,3).tickFormat(e),E=d3.svg.axis().scale(N).ticks(d3.time.years,1).tickFormat(d).tickSize(3,0).tickPadding(1).orient("bottom"),L=d3.format(".0%"),O=d3.svg.axis().scale(S).orient("left").tickFormat(L).ticks(5).tickSize(3,0).tickPadding(1),W=d3.select("body").append("div").attr("class","vis-tooltip"),H=d3.svg.line().x(function(e){return N(e.label)}).y(function(e){return S(e.value)}),D=d3.select(document.querySelector(i)).append("svg"),P=D.append("g").attr("transform","translate("+b.left+","+b.top+")"),I=d3.keys(c[0]).filter(function(e){return e!==g});C.domain(I),B.domain(I),T.domain(I),$.domain(I),M.domain(I),F.domain(I);var j=I.map(function(e){return{name:e,values:c.map(function(t){return{name:e,label:t[g],value:+t[e]}})}});N.domain(c.map(function(e){return e.date})),A.domain(c.map(function(e){return e.date})),S.domain([d3.min(j,function(e){return d3.min(e.values,function(e){return 0})}),d3.max(j,function(e){return d3.max(e.values,function(e){return e.value})})]);var R=P.append("g").attr("class","vis-x-axis").attr("transform","translate(0,"+k+")").call(_),G=(R.append("path").attr("class","line").style("stroke-width","1.5px").call(_),P.append("g").attr("class","vis-axis").attr("transform","translate(0,"+(k+15)+")").call(E)),Y=G.append("text").attr("x",(w-b.left)/2).attr("y",b.bottom-32).attr("dy","1em").attr("class","vis-x-axis-label").text("Quarter"),V=P.append("g").attr("class","vis-y-axis").call(O).append("text").attr("x",-(k/2)).attr("y",-44).attr("dy","1em").attr("class","vis-y-axis-label").text("Percent of Opioid-related Deaths"),z=P.selectAll(".series").data(j).enter().append("g").attr("class","seriesData"),q=z.append("path").attr("class","line").attr("d",function(e){return H(e.values)}).style("stroke",function(e){return C(e.name)}).style("stroke-width",function(e){return B(e.name)}).style("stroke-dasharray",function(e){return T(e.name)}).style("fill","none"),U=z.append("path").attr("class","hit-area-ext").attr("d",function(e){return H(e.values)}).attr("style","stroke:transparent;stroke-width:10px").style("fill","none"),X=P.append("g").attr("class","focus").classed("hidden",!0);X.append("circle").style("stroke-width",1).attr("r",6).attr("pointer-events","none"),d3.selectAll("g.seriesData").on("mouseover",a).on("mouseout",t).on("mousemove",n);var Q=D.append("g"),K=Q.append("g");r(),s(),window.addEventListener("resize",r)}(),function(){function e(){t(c.clientWidth),C.attr("width",h).attr("height",m),w.range([0,f]),k.range([v,0]),N.scale(w).tickFormat(y).ticks(f<500?4:10).orient("bottom").outerTickSize(0),A.scale(k).tickSize(f).orient("right").tickFormat(b),S.x(function(e){return w(e.age)}).y(function(e){return k(e.value)}).defined(function(e){return k(e.value)}),T.attr("transform","translate(0,"+v+")").call(N),M.call(A),B.selectAll(".vis-y-axis .tick text").attr("x",-5).attr("dy",0).style("text-anchor","end"),H.attr("width",f).attr("height",v),F.attr("x",(f-p.left)/2).attr("y",p.bottom/2).attr("dy","1em").attr("class","vis-x-axis-label").text("Fiscal Year"),_.attr("x",-(v-p.top)/2).attr("y",-p.left).attr("dy","1em").attr("class","vis-y-axis-label").text("Percent Primary Substance of Use"),n(),o(),s()}function t(e){h=e,f=h-p.left-p.right}function a(){O.opioids.circle=B.append("circle").attr("class","circle opioids").attr("r",3),O.opioids.text=B.append("g").append("text").attr("class","focus opioids").text("opioids"),O.alcohol.circle=B.append("circle").attr("class","circle alcohol").attr("r",3),O.alcohol.text=B.append("g").append("text").attr("class","focus alcohol").text("alcohol"),O.marijuana.circle=B.append("circle").attr("class","circle marijuana").attr("r",3),O.marijuana.text=B.append("g").append("text").attr("class","focus marijuana").text("marijuana"),O.other.circle=B.append("circle").attr("class","circle other").attr("r",3),O.other.text=B.append("g").append("text").attr("class","focus other").text("other")}function n(){var e=0,t=15;O.opioids.circle.attr("cx",f+L).attr("cy",e+1*t),O.opioids.text.attr("x",f+E).attr("y",e+1*t+3),O.alcohol.circle.attr("cx",f+L).attr("cy",e+2*t),O.alcohol.text.attr("x",f+E).attr("y",e+2*t+3),O.marijuana.circle.attr("cx",f+L).attr("cy",e+3*t),O.marijuana.text.attr("x",f+E).attr("y",e+3*t+3),O.other.circle.attr("cx",f+L).attr("cy",e+4*t),O.other.text.attr("x",f+E).attr("y",e+4*t+3)}function r(){for(W.alcohol=B.append("path").attr("class","line alcohol").attr("pointer-events","none"),i=0;i<x[u+"alcohol"].values.length;i++){var e=(x[u+"alcohol"].values[i].age,x[u+"alcohol"].values[i].value);e>=0&&B.append("circle").attr("class",function(e){return"circle alcohol y"+x[u+"alcohol"].values[i].age}).attr("cx",w(x[u+"alcohol"].values[i].age)).attr("cy",k(x[u+"alcohol"].values[i].value)).attr("r",3).attr("pointer-events","none")}for(W.marijuana=B.append("path").attr("class","line marijuana").attr("pointer-events","none"),i=0;i<x[u+"marijuana"].values.length;i++){var e=(x[u+"marijuana"].values[i].age,x[u+"marijuana"].values[i].value);e>=0&&B.append("circle").attr("class",function(e){return"circle marijuana y"+x[u+"marijuana"].values[i].age}).attr("cx",w(x[u+"marijuana"].values[i].age)).attr("cy",k(x[u+"marijuana"].values[i].value)).attr("r",3).attr("pointer-events","none")}for(W.opioids=B.append("path").attr("class","line opioids").attr("pointer-events","none"),i=0;i<x[u+"opioids"].values.length;i++){var e=(x[u+"opioids"].values[i].age,x[u+"opioids"].values[i].value);e>=0&&B.append("circle").attr("class",function(e){return"circle opioids y"+x[u+"opioids"].values[i].age}).attr("cx",w(x[u+"opioids"].values[i].age)).attr("cy",k(x[u+"opioids"].values[i].value)).attr("r",3).attr("pointer-events","none")}for(W.other=B.append("path").attr("class","line other").attr("pointer-events","none"),i=0;i<x[u+"other"].values.length;i++){var e=(x[u+"other"].values[i].age,x[u+"other"].values[i].value);e>=0&&B.append("circle").attr("class",function(e){return"circle other y"+x[u+"other"].values[i].age}).attr("cx",w(x[u+"other"].values[i].age)).attr("cy",k(x[u+"other"].values[i].value)).attr("r",3).attr("pointer-events","none")}}function o(){W.alcohol.attr("d",function(e){return S(x[u+"alcohol"].values)}),W.opioids.attr("d",function(e){return S(x[u+"opioids"].values)}),W.marijuana.attr("d",function(e){return S(x[u+"marijuana"].values)}),W.other.attr("d",function(e){return S(x[u+"other"].values)})}function s(){for(B.select(".line.alcohol").transition().duration(1e3).delay(180).attr("d",function(e){return S(x[u+"alcohol"].values)}),i=0;i<x[u+"alcohol"].values.length;i++){var e=".circle.alcohol.y"+x[u+"alcohol"].values[i].age;x[u+"alcohol"].values[i].value>=0?B.selectAll(e).transition().duration(1e3).attr("cx",function(e){return w(x[u+"alcohol"].values[i].age)}).attr("cy",function(e){return k(x[u+"alcohol"].values[i].value)}).attr("r",3):B.selectAll(e).transition().duration(1e3).attr("r",0)}for(B.select(".line.marijuana").transition().duration(1e3).attr("d",function(e){return S(x[u+"marijuana"].values)}),i=0;i<x[u+"marijuana"].values.length;i++){var e=".circle.marijuana.y"+x[u+"marijuana"].values[i].age;x[u+"marijuana"].values[i].value>=0?B.selectAll(e).transition().duration(1e3).attr("cx",function(e){return w(x[u+"marijuana"].values[i].age)}).attr("cy",function(e){return k(x[u+"marijuana"].values[i].value)}).attr("r",3):B.selectAll(e).transition().duration(1e3).attr("r",0)}for(B.select(".line.opioids").transition().duration(1e3).attr("d",function(e){return S(x[u+"opioids"].values)}),i=0;i<x[u+"opioids"].values.length;i++){var e=".circle.opioids.y"+x[u+"opioids"].values[i].age,t=x[u+"opioids"].values[i].value;t>=0?B.selectAll(e).transition().duration(1e3).attr("cx",function(e){return w(x[u+"opioids"].values[i].age)}).attr("cy",function(e){return k(x[u+"opioids"].values[i].value)}).attr("r",3):B.selectAll(e).transition().duration(1e3).attr("r",0)}for(B.select(".line.other").transition().duration(1e3).attr("d",function(e){return S(x[u+"other"].values)}),i=0;i<x[u+"other"].values.length;i++){var e=".circle.other.y"+x[u+"other"].values[i].age,t=x[u+"other"].values[i].value;t>=0?B.selectAll(e).transition().duration(1e3).attr("cx",function(e){return w(x[u+"other"].values[i].age)}).attr("cy",function(e){return k(x[u+"other"].values[i].value)}).attr("r",3):B.selectAll(e).transition().duration(1e3).attr("r",0)}}function l(e,t){return d3.keys(e).forEach(function(t){e[t]=+e[t],"age"!=t&&(t in x?x[t].values.push({age:e.age,value:e[t]}):x[t]={values:[{age:e.age,value:e[t]}]})}),e}var c=document.querySelector("#lines-bsas"),d={abington:"Abington",acton:"Acton",acushnet:"Acushnet",adams:"Adams",agawam:"Agawam",alford:"Alford",amesbury:"Amesbury",amherst:"Amherst",andover:"Andover",aquinnah:"Aquinnah",arlington:"Arlington",ashburnham:"Ashburnham",ashby:"Ashby",ashfield:"Ashfield",ashland:"Ashland",athol:"Athol",attleboro:"Attleboro",auburn:"Auburn",avon:"Avon",ayer:"Ayer",barnstable:"Barnstable",barre:"Barre",becket:"Becket",bedford:"Bedford",belchertown:"Belchertown",bellingham:"Bellingham",belmont:"Belmont",berkley:"Berkley",berlin:"Berlin",bernardston:"Bernardston",beverly:"Beverly",billerica:"Billerica",blackstone:"Blackstone",blandford:"Blandford",bolton:"Bolton",boston:"Boston",bourne:"Bourne",boxborough:"Boxborough",boxford:"Boxford",boylston:"Boylston",braintree:"Braintree",brewster:"Brewster",bridgewater:"Bridgewater",brimfield:"Brimfield",brockton:"Brockton",brookfield:"Brookfield",brookline:"Brookline",buckland:"Buckland",burlington:"Burlington",cambridge:"Cambridge",canton:"Canton",carlisle:"Carlisle",carver:"Carver",charlemont:"Charlemont",charlton:"Charlton",chatham:"Chatham",chelmsford:"Chelmsford",chelsea:"Chelsea",cheshire:"Cheshire",chester:"Chester",chesterfield:"Chesterfield",chicopee:"Chicopee",chilmark:"Chilmark",clarksburg:"Clarksburg",clinton:"Clinton",cohasset:"Cohasset",colrain:"Colrain",concord:"Concord",conway:"Conway",cummington:"Cummington",dalton:"Dalton",danvers:"Danvers",dartmouth:"Dartmouth",dedham:"Dedham",deerfield:"Deerfield",dennis:"Dennis",dighton:"Dighton",douglas:"Douglas",dover:"Dover",dracut:"Dracut",dudley:"Dudley",dunstable:"Dunstable",duxbury:"Duxbury",eastbridgewater:"East Bridgewater",eastbrookfield:"East Brookfield",eastham:"Eastham",easthampton:"Easthampton",eastlongmeadow:"East Longmeadow",easton:"Easton",edgartown:"Edgartown",egremont:"Egremont",erving:"Erving",essex:"Essex",everett:"Everett",fairhaven:"Fairhaven",fallriver:"Fall River",falmouth:"Falmouth",fitchburg:"Fitchburg",florida:"Florida",foxborough:"Foxborough",framingham:"Framingham",franklin:"Franklin",freetown:"Freetown",gardner:"Gardner",georgetown:"Georgetown",gill:"Gill",gloucester:"Gloucester",goshen:"Goshen",gosnold:"Gosnold",grafton:"Grafton",granby:"Granby",granville:"Granville",greatbarrington:"Great Barrington",greenfield:"Greenfield",groton:"Groton",groveland:"Groveland",hadley:"Hadley",halifax:"Halifax",hamilton:"Hamilton",hampden:"Hampden",hancock:"Hancock",hanover:"Hanover",hanson:"Hanson",hardwick:"Hardwick",harvard:"Harvard",harwich:"Harwich",hatfield:"Hatfield",haverhill:"Haverhill",hawley:"Hawley",heath:"Heath",hingham:"Hingham",hinsdale:"Hinsdale",holbrook:"Holbrook",holden:"Holden",holland:"Holland",holliston:"Holliston",holyoke:"Holyoke",hopedale:"Hopedale",hopkinton:"Hopkinton",hubbardston:"Hubbardston",hudson:"Hudson",hull:"Hull",huntington:"Huntington",ipswich:"Ipswich",kingston:"Kingston",lakeville:"Lakeville",lancaster:"Lancaster",lanesborough:"Lanesborough",lawrence:"Lawrence",lee:"Lee",leicester:"Leicester",lenox:"Lenox",leominster:"Leominster",leverett:"Leverett",lexington:"Lexington",leyden:"Leyden",lincoln:"Lincoln",littleton:"Littleton",longmeadow:"Longmeadow",lowell:"Lowell",ludlow:"Ludlow",lunenburg:"Lunenburg",lynn:"Lynn",lynnfield:"Lynnfield",malden:"Malden",manchester:"Manchester",mansfield:"Mansfield",marblehead:"Marblehead",marion:"Marion",marlborough:"Marlborough",marshfield:"Marshfield",mashpee:"Mashpee",mattapoisett:"Mattapoisett",maynard:"Maynard",medfield:"Medfield",medford:"Medford",medway:"Medway",melrose:"Melrose",mendon:"Mendon",merrimac:"Merrimac",methuen:"Methuen",middleborough:"Middleborough",middlefield:"Middlefield",middleton:"Middleton",milford:"Milford",millbury:"Millbury",millis:"Millis",millville:"Millville",milton:"Milton",monroe:"Monroe",monson:"Monson",montague:"Montague",monterey:"Monterey",montgomery:"Montgomery",mountwashington:"Mount Washington",nahant:"Nahant",nantucket:"Nantucket",natick:"Natick",needham:"Needham",newashford:"New Ashford",newbedford:"New Bedford",newbraintree:"New Braintree",newbury:"Newbury",newburyport:"Newburyport",newmarlborough:"New Marlborough",newsalem:"New Salem",newton:"Newton",norfolk:"Norfolk",northadams:"North Adams",northampton:"Northampton",northandover:"North Andover",northattleborough:"North Attleborough",northborough:"Northborough",northbridge:"Northbridge",northbrookfield:"North Brookfield",northfield:"Northfield",northreading:"North Reading",norton:"Norton",norwell:"Norwell",norwood:"Norwood",oakbluffs:"Oak Bluffs",oakham:"Oakham",orange:"Orange",orleans:"Orleans",otis:"Otis",oxford:"Oxford",palmer:"Palmer",paxton:"Paxton",peabody:"Peabody",pelham:"Pelham",pembroke:"Pembroke",pepperell:"Pepperell",peru:"Peru",petersham:"Petersham",phillipston:"Phillipston",pittsfield:"Pittsfield",plainfield:"Plainfield",plainville:"Plainville",plymouth:"Plymouth",plympton:"Plympton",princeton:"Princeton",provincetown:"Provincetown",quincy:"Quincy",randolph:"Randolph",raynham:"Raynham",reading:"Reading",rehoboth:"Rehoboth",revere:"Revere",richmond:"Richmond",rochester:"Rochester",rockland:"Rockland",rockport:"Rockport",rowe:"Rowe",rowley:"Rowley",royalston:"Royalston",russell:"Russell",rutland:"Rutland",salem:"Salem",salisbury:"Salisbury",sandisfield:"Sandisfield",sandwich:"Sandwich",saugus:"Saugus",savoy:"Savoy",scituate:"Scituate",seekonk:"Seekonk",sharon:"Sharon",sheffield:"Sheffield",shelburne:"Shelburne",sherborn:"Sherborn",shirley:"Shirley",shrewsbury:"Shrewsbury",shutesbury:"Shutesbury",somerset:"Somerset",somerville:"Somerville",southampton:"Southampton",southborough:"Southborough",southbridge:"Southbridge",southhadley:"South Hadley",southwick:"Southwick",spencer:"Spencer",springfield:"Springfield",sterling:"Sterling",stockbridge:"Stockbridge",stoneham:"Stoneham",stoughton:"Stoughton",stow:"Stow",sturbridge:"Sturbridge",sudbury:"Sudbury",sunderland:"Sunderland",sutton:"Sutton",swampscott:"Swampscott",swansea:"Swansea",taunton:"Taunton",templeton:"Templeton",tewksbury:"Tewksbury",tisbury:"Tisbury",tolland:"Tolland",topsfield:"Topsfield",townsend:"Townsend",truro:"Truro",tyngsborough:"Tyngsborough",tyringham:"Tyringham",upton:"Upton",uxbridge:"Uxbridge",wakefield:"Wakefield",wales:"Wales",walpole:"Walpole",waltham:"Waltham",ware:"Ware",wareham:"Wareham",warren:"Warren",warwick:"Warwick",washington:"Washington",watertown:"Watertown",wayland:"Wayland",webster:"Webster",wellesley:"Wellesley",wellfleet:"Wellfleet",wendell:"Wendell",wenham:"Wenham",westborough:"Westborough",westboylston:"West Boylston",westbridgewater:"West Bridgewater",westbrookfield:"West Brookfield",westfield:"Westfield",westford:"Westford",westhampton:"Westhampton",westminster:"Westminster",westnewbury:"West Newbury",weston:"Weston",westport:"Westport",westspringfield:"West Springfield",weststockbridge:"West Stockbridge",westtisbury:"West Tisbury",westwood:"Westwood",weymouth:"Weymouth",whately:"Whately",whitman:"Whitman",wilbraham:"Wilbraham",williamsburg:"Williamsburg",williamstown:"Williamstown",wilmington:"Wilmington",winchendon:"Winchendon",winchester:"Winchester",windsor:"Windsor",winthrop:"Winthrop",woburn:"Woburn",worcester:"Worcester",worthington:"Worthington",wrentham:"Wrentham",yarmouth:"Yarmouth"},u="massachusetts",p={top:0,right:25,bottom:35,left:45},h=c.clientWidth,m=400,f=h-p.left-p.right,v=m-p.top-p.bottom,g=d3.bisector(function(e){return e.age}).left,b=d3.format(",.0%"),y=d3.format("d"),x={},w=d3.scale.linear(),k=d3.scale.linear(),N=(d3.scale.category10(),d3.svg.axis()),A=d3.svg.axis(),S=d3.svg.line(),C=d3.select("#lines-bsas").append("svg"),B=C.append("g").attr("transform","translate("+p.left+","+p.top+")"),T=B.append("g").attr("class","vis-x-axis");T.append("text").attr("x",635).attr("y",15).attr("text-anchor","middle").text("Year");var M=B.append("g").attr("class","vis-y-axis");M.append("text");var F=T.append("text"),_=M.append("text"),E=-60,L=-70,O={opioids:{},alcohol:{},marijuana:{},other:{},none:{}};a();var W={},H=B.append("rect").attr("class","overlay");d3.csv("js/data/bsas-data-2000to2015.csv",l,function(t,a){function n(){var e=w.invert(d3.mouse(this)[0]),t=g(x[u+"alcohol"].values,e,1),a=x[u+"alcohol"].values[t-1],n=x[u+"alcohol"].values[t],r=e-a.age>n.age-e?n:a;r.value>=0?(o.attr("transform","translate("+w(r.age)+","+k(r.value)+")"),o.select("text").text(b(r.value)).attr("transform","translate(-28,0)"),o.select("circle").attr("r",4)):(o.select("circle").attr("r",0),o.select("text").text(""));var s=g(x[u+"marijuana"].values,e,1),d=x[u+"marijuana"].values[s-1],p=x[u+"marijuana"].values[s],h=e-d.age>p.age-e?p:d;h.value>=0?(i.attr("transform","translate("+w(h.age)+","+k(h.value)+")"),i.select("text").text(b(h.value)).attr("transform","translate(-28,0)"),i.select("circle").attr("r",4)):(i.select("circle").attr("r",0),i.select("text").text(""));var m=g(x[u+"opioids"].values,e,1),f=x[u+"opioids"].values[m-1],v=x[u+"opioids"].values[m],y=e-f.age>v.age-e?v:f;y.value>=0?(l.attr("transform","translate("+w(y.age)+","+k(y.value)+")"),l.select("text").text(b(y.value)),l.select("circle").attr("r",4)):(l.select("circle").attr("r",0),l.select("text").text(""));var N=g(x[u+"other"].values,e,1),A=x[u+"other"].values[N-1],S=x[u+"other"].values[N],C=e-A.age>S.age-e?S:A;C.value>=0?(c.attr("transform","translate("+w(C.age)+","+k(C.value)+")"),c.select("text").text(b(C.value)),c.select("circle").attr("r",4)):(c.select("circle").attr("r",0),c.select("text").text("")),e>80?(o.select("text").attr("x",3).attr("y",-7).attr("text-anchor","beginning"),i.select("text").attr("x",3).attr("y",-7).attr("text-anchor","beginning"),l.select("text").attr("x",3).attr("y",-7).attr("text-anchor","beginning"),c.select("text").attr("x",3).attr("y",-7).attr("text-anchor","beginning")):(o.select("text").attr("x",10).attr("text-anchor","beginning"),i.select("text").attr("x",10).attr("text-anchor","beginning"),l.select("text").attr("x",10).attr("text-anchor","beginning"),c.select("text").attr("x",10).attr("text-anchor","beginning"))}if(t)throw t;w.domain([2e3,d3.max(a,function(e){return e.age})]),k.domain([0,1]),r(),e(),window.addEventListener("resize",e),$(".btn-bsas").addClass("active"),d3.selectAll(".btn-bsas").on("click",function(){u=d3.select(this).attr("data-val"),s(),d3.select(this).classed("active",!0),$("#tags").val("")}),$("#tags").autocomplete({source:function(e,t){var a=$.map(d,function(t){if(0===t.toUpperCase().indexOf(e.term.toUpperCase()))return t});t(a)},select:function(e,t){$.each(d,function(e,a){a===t.item.value&&(u=e,console.log(a))}),$(".btn-bsas").removeClass("active"),s()}});var o=B.append("g").attr("class","focus alcohol").style("display","none");o.append("circle").attr("pointer-events","none").attr("r",3),o.append("text").attr("pointer-events","none").attr("x",9).attr("dy",".35em");var i=B.append("g").attr("class","focus marijuana").style("display","none");i.append("circle").attr("pointer-events","none").attr("r",3),i.append("text").attr("pointer-events","none").attr("x",9).attr("dy",".35em");var l=B.append("g").attr("class","focus opioids").style("display","none");l.append("circle").attr("pointer-events","none").attr("r",3),l.append("text").attr("pointer-events","none").attr("x",9).attr("dy",".35em");var c=B.append("g").attr("class","focus other").style("display","none");c.append("circle").attr("pointer-events","none").attr("r",3),c.append("text").attr("pointer-events","none").attr("x",9).attr("dy",".35em"),H.on("mouseover",function(){i.style("display",null),o.style("display",null),l.style("display",null),c.style("display",null)}).on("mouseout",function(){i.style("display","none"),o.style("display","none"),l.style("display","none"),c.style("display","none")}).on("mousemove",n)})}(),$(document).ready(function(){function e(e,a){$("#percentage").html(e[a].Yes+"%"),$("#people").empty(),$("#people").each(function(){t(e,a),$("#table_substance").html('<table class="table table_substance"><tr><th>Had legal prescription</th><th>Did not have legal prescription</th></tr><tr><td class="type_substance0">'+e[a].Yes+'%</td><td class="type_substance1">'+e[a].No+"%</td></tr></table>")})}function t(e,t){var r=[],o=Math.round(e[t].No),s=Math.round(e[t].Yes);blockArray=a("#people",s,o,e,r,t),n("#people",r,0)}function a(e,t,a,n,r,o){var s='<path d="M4,12.6c0-0.7,0-1.5,0-2.2c0-1,0.5-1.8,1.4-2.2C6,7.9,6.6,7.8,7.3,7.8c0.7,0,1.4,0,2.1,0c0.7,0,1.4,0.2,2,0.6c0.7,0.4,1.1,1.1,1.1,2c0,1.5,0,3,0,4.5c0,0.9-0.2,1.8-0.8,2.6c-0.1,0.2-0.3,0.3-0.4,0.5c-0.1,0.1-0.1,0.2-0.2,0.3c-0.1,0.6-0.3,1.2-0.4,1.8c-0.2,1.3-0.4,2.6-0.6,3.8c-0.1,0.7-0.6,1.1-1.3,1.1c-0.4,0-0.8,0-1.2,0c-0.1,0-0.2,0-0.3,0c-0.5-0.1-0.9-0.5-1-1c-0.2-1.2-0.4-2.4-0.6-3.5c-0.1-0.6-0.2-1.2-0.3-1.8c-0.1-0.3-0.2-0.5-0.4-0.7c-0.4-0.3-0.6-0.8-0.7-1.3C4.1,15.9,4,15.3,4,14.7C4,14,4,13.3,4,12.6z"/><path d="M4.8,3.6c0-1.8,1.4-3.4,3.4-3.5c1.9,0,3.5,1.5,3.5,3.5c0,2-1.5,3.4-3.5,3.4C6.3,7,4.8,5.5,4.8,3.6z"/>',i='<svg class="block type_substance1" width="25px" height="25px">'+s+"</svg>";for(b=0;b<a;b++)r.push(i);for(b=0;b<t;b++){var l='<svg class="block type_substance0" width="25px" height="25px">'+s+"</svg>";$(e).append(l)}return r}function n(e,t,a){a<blockArray.length&&($(e).append(t[a]),a++,n(e,t,a))}function r(e){$("#bar_svg").append("g").attr("class","bar_g"),xMax=d3.max(u,function(e){return d3.max(e,function(e){return e.x+e.x0})}),xScale=d3.scale.linear().domain([0,xMax]).range([0,v]),yScale=d3.scale.ordinal().rangeRoundBands([0,g],.1),colours=d3.scale.ordinal().range(e),bar_groups=x.selectAll(".bar_g").data(u).enter().append("g").style("fill",function(e,t){return colours(t)}),rects=bar_groups.selectAll("rect").data(function(e){return e}).enter().append("rect").style({stroke:"#b71c1c","stroke-width":"1px"}).attr("x",function(e){return xScale(e.x0)}).attr("y",function(e,t){return yScale(e.y)}).attr("height",function(e){return yScale.rangeBand()}).attr("width",function(e){return xScale(e.x)})}for(var o=[{Yes:83,No:17},{Yes:57,No:43},{Yes:50,No:50},{Yes:37,No:63}],s=[{Yes:65,No:35},{Yes:28,No:72},{Yes:20,No:80},{Yes:13,No:87}],i=[{Yes:68,No:32},{Yes:30,No:70},{Yes:22,No:78},{Yes:17,No:83}],l=[{Yes:64,No:36},{Yes:24,No:76},{Yes:15,No:85},{Yes:9,No:91}],c=[{Yes:76,No:24},{Yes:46,No:54},{Yes:41,No:59},{Yes:27,No:73}],d=[{Yes:60,No:40},{Yes:60,No:40},{Yes:60,No:40},{Yes:60,No:40}],u=[{data:[{count:867,name:"Heroin",alias:s}],name:"Heroin"},{data:[{count:288,name:"Fentanyl",alias:i}],name:"Fentanyl"},{data:[{count:249,name:"both Fentanyl & Heroin",alias:l}],name:"Fentanyl & Heroin"},{data:[{count:154,name:"Prescription Opioids",alias:o}],name:"Prescription Opioids"},{data:[{count:84,name:"Methadone",alias:c}],name:"Methadone"}],p=0;p<5;p++){var h=$("<dl>");h.append("<dt>"+u[p].data[0].count+" people had a positive "+u[p].data[0].name.toLowerCase()+" toxicology screen from 2013-2014.</dt>"),h.append("<dd>Of those with a positive "+u[p].data[0].name.toLowerCase()+" toxicology screen, "+u[p].data[0].alias[0].Yes+"% had a legal opioid prescription at some point from 2011 - 2014, "+u[p].data[0].alias[1].Yes+"% had a legal opioid prescription 6 month before death, "+u[p].data[0].alias[2].Yes+"% had a legal opioid prescription 3 month before death, and "+u[p].data[0].alias[3].Yes+"% had a legal opioid prescription 1 month before death.</dd>"),$("#sr-blocks-bar").append(h)}var m=o,f=0;e(m,f),$(".btn-substance").on("click",function(){var t,a=parseInt($(this).val());switch($(".btn-time").removeClass("disableClick disabled"),a){case 0:t=s;break;case 1:t=i;break;case 2:t=l;break;case 3:t=o;break;case 4:t=c;break;case 5:t=d,$(".btn-time").removeClass("active").addClass("disableClick disabled"),$("#studyperiod").addClass("active")}m=t,e(m,f)}),$(".btn-time").on("click",function(){$(".btn-time").removeClass("active"),$(this).addClass("active"),f=parseInt($(this).val()),e(m,f);var t;switch(f){case 0:t="during 2011–2014";break;case 1:t="6 Months Before Death";break;case 2:t="3 Months Before Death";break;case 3:t="1 Month Before Death"}$("#time-period").html(t.toLowerCase()),$("#label_blocks").html(t)});var v="100%",g=30;u=u.map(function(e){return e.data.map(function(e,t){return{y:e.count,s:e.name}})}),stack=d3.layout.stack(),stack(u);var y,u=u.map(function(e){return e.map(function(e){return{x:e.y,n:e.s,y:e.x,x0:e.y0}})}),x=d3.select("#bar").append("svg").attr("id","bar_svg").attr("width",v).attr("height",g),w=["#b71c1c","#CFD8DC"];y=[w[1],w[1],w[1],w[0],w[1],w[1]],r(y),$(".btn-substance").on("click",function(){$("#bar_svg").empty(),y=[w[1],w[1],w[1],w[1],w[1],w[1]],$(".btn-substance").removeClass("active"),$(this).addClass("active"),y[$(this).val()]=w[0],r(y);var e=$(this).val(),t=u[$(this).val()][0];parseFloat(xScale(t.x0)+100/(e+1)),parseFloat(d3.select(this).attr("y"))+yScale.rangeBand();console.log(t),console.log("Fentanyl & Heroin"==t.n),"both Fentanyl & Heroin"==t.n?substance_html=t.n+'<a href="#footnote-16" class="page-scroll"><sup>16</sup></a>':"Prescription Opioids"==t.n?substance_html=t.n.toLowerCase()+'<a href="#footnote-15" class="page-scroll"><sup>15</sup></a>':substance_html=t.n,console.log(substance_html),$(".substance-type").html(substance_html),$("#total").html(t.x)})}),$(document).ready(function(){function asignVal_gender(option,value){$("#buttons-blocks button").removeClass("active"),$("#"+option).addClass("active"),$("#gender").empty(),makeChart_gender(eval(option)),$("#table_gender").html(table_html[value])}function makeChart_gender(e){var t=[];if(e==multi)var a=[0,1,2,3,4,5];else var a=[0,0,2,3,5,5];for(i=0;i<6;i++){var n=Math.round(e[i][1]);blockArray_gender=addBlocks_gender("#gender",n,e,t,a)}addBlock_gender("#gender",blockArray_gender,0)}function addBlock_gender(e,t,a){a<t.length&&($(e).append(t[a]),a++,addBlock_gender(e,t,a))}function addBlocks_gender(e,t,a,n,r){for(b=0;b<t;b++){var o='<svg class="block type_gender'+r[i]+" data-index="+a[i][0]+' width="25px" height="25px"><path d="M4,12.6c0-0.7,0-1.5,0-2.2c0-1,0.5-1.8,1.4-2.2C6,7.9,6.6,7.8,7.3,7.8c0.7,0,1.4,0,2.1,0c0.7,0,1.4,0.2,2,0.6c0.7,0.4,1.1,1.1,1.1,2c0,1.5,0,3,0,4.5c0,0.9-0.2,1.8-0.8,2.6c-0.1,0.2-0.3,0.3-0.4,0.5c-0.1,0.1-0.1,0.2-0.2,0.3c-0.1,0.6-0.3,1.2-0.4,1.8c-0.2,1.3-0.4,2.6-0.6,3.8c-0.1,0.7-0.6,1.1-1.3,1.1c-0.4,0-0.8,0-1.2,0c-0.1,0-0.2,0-0.3,0c-0.5-0.1-0.9-0.5-1-1c-0.2-1.2-0.4-2.4-0.6-3.5c-0.1-0.6-0.2-1.2-0.3-1.8c-0.1-0.3-0.2-0.5-0.4-0.7c-0.4-0.3-0.6-0.8-0.7-1.3C4.1,15.9,4,15.3,4,14.7C4,14,4,13.3,4,12.6z"/><path d="M4.8,3.6c0-1.8,1.4-3.4,3.4-3.5c1.9,0,3.5,1.5,3.5,3.5c0,2-1.5,3.4-3.5,3.4C6.3,7,4.8,5.5,4.8,3.6z"/></svg>';n.push(o)}return n}var prescription=[[0,0],["No",58],["Yes",13],["Yes",8],["No",21],[0,0]],heroin=[[0,0],["No",22],["Yes",49],["Yes",17],["No",12],[0,0]],multi=[["1",15],["2",31],["3",25],["3",18],["2",9],["1",2]],table_html=['<div class="people-blocks">Prescription Opioids in Toxicology Screen</div><table class="table table_gender"><tr><th></th><th>Present</th><th>Not Present</th></tr><tr><th>Male</th><td class="type_gender2">'+prescription[2][1]+'%</td><td class="type_gender0">'+prescription[1][1]+'%</td></tr><tr><th>Female</th><td class="type_gender3">'+prescription[3][1]+'%</td><td class="type_gender5">'+prescription[4][1]+"%</td></tr></table>",'<div class="people-blocks">Heroin in Toxicology Screen</div><table class="table table_gender"><tr><th></th><th>Present</th><th>Not Present</th></tr><tr><th>Male</th><td class="type_gender2">'+heroin[2][1]+'%</td><td class="type_gender0">'+heroin[1][1]+'%</td></tr><tr><th>Female</th><td class="type_gender3">'+heroin[3][1]+'%</td><td class="type_gender5">'+heroin[4][1]+"%</td></tr></table>",'<div class="people-blocks">Number of Different Prescribers</div><table class="table table_gender"><tr><th></th><th>0 Prescribers</th><th>1–2 Prescribers</th><th>3+ Prescribers</th></tr><tr><th>Male</th><td td class="type_gender0">'+multi[0][1]+'%</td><td td class="type_gender1">'+multi[1][1]+'%</td><td td class="type_gender2">'+multi[2][1]+'%</td></tr><tr><th>Female</th><td td class="type_gender5">'+multi[5][1]+'%</td><td td class="type_gender4">'+multi[4][1]+'%</td><td td class="type_gender3">'+multi[3][1]+"%</td></tr></table>"],data_gender=prescription,value,option;makeChart_gender(prescription),$("#table_gender").html(table_html[0]),$("#prescription").addClass("active"),$(".controls-block").click(function(){$option=$(this).data("select"),"multi"==$option?$value=2:"heroin"==$option?$value=1:($option="prescription")&&($value=0),console.log($value),asignVal_gender($option,$value)}),$(".btn-blocks").click(function(){$option=$(this).attr("id"),$value=eval($(this).val()),asignVal_gender($option,$value)})}),function(){function e(){r=document.querySelector("#changing_bars").clientWidth-100,o=300,s=50,i.attr("width",r+100).attr("height",o+10)}function t(e,t){return e.sort(function(e,a){return a[t]-e[t]})}function a(e,t){d.text(n(t)).attr("class","vis-label").style("text-anchor","end").attr("y",12).attr("x",r+s+s);var a=d3.max(e,function(e){return+e[t]});xScale=d3.scale.linear().domain([0,a]).range([0,r]),yScale=d3.scale.ordinal().domain(d3.range(e.length)).rangeBands([20,o],.2);var l=i.selectAll("rect.bar").data(e,function(e){return e.gender_age});u.attr("class","vis-legend").attr("transform",function(e,t){return"translate("+(r-10)+","+(o-2*s+24*t)+")"}),l.enter().append("rect").attr("class","bar"),l.exit().transition().duration(200).ease("exp").attr("width",0).remove(),
l.transition().duration(500).ease("quad").attr("width",function(e){return xScale(+e[t])}).attr("height",yScale.rangeBand()).attr("transform",function(e,t){return"translate("+[0+s,yScale(t)]+")"}).attr("class",function(e,t){return"Male"===e.gender&&"18 to 24"===e.age?"bar malFocus age18to24":"Female"===e.gender&&"18 to 24"===e.age?"bar femFocus age18to24":"Female"===e.gender&&"25 to 34"===e.age?"bar femFocus age25to34":"Male"===e.gender&&"25 to 34"===e.age?"bar malFocus age25to34":"Female"===e.gender&&"35 to 49"===e.age?"bar femFocus age35to49":"Male"===e.gender&&"35 to 49"===e.age?"bar malFocus age35to49":"Female"===e.gender&&"50 to 64"===e.age?"bar femFocus age50to64":"Male"===e.gender&&"50 to 64"===e.age?"bar malFocus age50to64":"Female"===e.gender?"bar femFocus age65plus":"Male"===e.gender?"bar malFocus age65plus":void 0});var c=i.selectAll("text.vis-data-label").data(e,function(e){return e.gender_age}),p=i.selectAll("text.vis-axis").data(e,function(e){return e.gender_age});p.enter().append("text").attr("class",function(e,t){return"25 to 34"==e.age?"vis-axis lab25to34":"18 to 24"==e.age?"vis-axis lab18to24":"vis-axis"}),p.exit().remove(),c.enter().append("text").attr("class",function(e,t){return"25 to 34"==e.age?"vis-data-label lab25to34":"18 to 24"==e.age?"vis-data-label lab18to24":"vis-data-label"}),c.exit().remove(),numberFormat=d3.format(".0f"),percentageFormat=d3.format(".1f"),rateFormat=d3.format(".1f"),c.transition().duration(500).attr("transform",function(e,a){return"translate("+(xScale(+e[t])+s)+","+(yScale(a)+4)+")"}).text(function(e){return"percentOpiodDeaths"==t&&"65+"==e.age?"<1%":"percentOpiodDeaths"==t&&"65+"!=e.age?percentageFormat(e[t])+"%":"numberOpioidDeaths"==t?numberFormat(e[t]):rateFormat(e[t])}).attr("dy","1em").attr("dx","5px"),p.transition().duration(500).attr("transform",function(e,t){return"translate(0,"+(yScale(t)+5)+")"}).text(function(e){return e.age}).attr("dy","1em").attr("dx","40px")}function n(e){var t={percentOpiodDeaths:"Percent of Opioid-related Deaths Among All Deaths",deathRate:"Opioid-related Death Rate per 100,000 People per Year",numberOpioidDeaths:"Number of Opioid-related Deaths from 2013 to 2014"};return t[e]}var r=600,o=300,s=50,i=d3.select("#changing_bars").append("svg").attr("width",r+100).attr("height",o+10);i.append("rect").attr("width","100%").attr("height","100%").attr("fill","none");var l=d3.scale.ordinal().range(["malFocus","femFocus"]),c=d3.scale.ordinal().range(["Male","Female"]),d=(i.append("text").text("Age").attr("class","vis-x-axis-label").style("text-anchor","start").attr("y",25).attr("x",10),i.append("text")),u=i.selectAll(".vis-legend").data(["male","female"]).enter().append("g");u.append("rect").attr("x",0).attr("width",20).attr("height",20).attr("class",l),u.append("text").attr("x",25).attr("y",9).attr("dy",".5em").style("text-anchor","start").text(c),d3.csv("js/data/bars-age.csv",function(n,r){var o="percentOpiodDeaths",s=t(r,o);e(),a(s,o),window.addEventListener("resize",function(){e(),a(s,o)}),d3.select("#POD").classed("selected",!0),$("#POD").addClass("active"),d3.select("#POD").on("click",function(e,n){o="percentOpiodDeaths",s=t(r,o),a(s,o);var i=d3.select(this);d3.selectAll("#buttons-bar button").classed("selected",!1),$("#buttons-bar button").removeClass("active"),d3.selectAll("#age18to24").classed("selected",!1),$("#age18to24").removeClass("active"),i.classed("selected",!0),$(this).addClass("active"),d3.selectAll(".lab18to24").classed("ageSelector",!1),d3.selectAll(".lab25to34").classed("ageSelector",!1)}),d3.select("#DR").on("click",function(e,n){o="deathRate",s=t(r,o),a(s,o);var i=d3.select(this);d3.selectAll("#buttons-bar button").classed("selected",!1),$("#buttons-bar button").removeClass("active"),d3.selectAll("#age18to24").classed("selected",!1),$("#age18to24").removeClass("active"),i.classed("selected",!0),$(this).addClass("active"),d3.selectAll(".lab18to24").classed("ageSelector",!1),d3.selectAll(".lab25to34").classed("ageSelector",!1)}),d3.select("#NOD").on("click",function(e,n){o="numberOpioidDeaths",s=t(r,o),a(s,o);var i=d3.select(this);d3.selectAll("#buttons-bar button").classed("selected",!1),$("#buttons-bar button").removeClass("active"),d3.selectAll("#age18to24").classed("selected",!1),$("#age18to24").removeClass("active"),i.classed("selected",!0),$(this).addClass("active"),d3.selectAll(".lab18to24").classed("ageSelector",!1),d3.selectAll(".lab25to34").classed("ageSelector",!1)}),d3.select("#age18to24").on("click",function(e,t){var a=d3.select(this);a.classed("selected",!0),$(this).addClass("active"),d3.selectAll(".bar.malFocus").classed("malSelector",!0),d3.selectAll(".bar.femFocus").classed("femSelector",!0),d3.selectAll(".lab18to24").classed("ageSelector",!0),d3.selectAll(".bar.malFocus.age18to24").classed("malSelector",!1),d3.selectAll(".bar.femFocus.age18to24").classed("femSelector",!1),d3.selectAll(".vis-axis").classed("noageSelector",!0),d3.selectAll(".vis-data-label").classed("noageSelector",!0),d3.selectAll(".lab18to24").classed("noageSelector",!1).classed("ageSelector",!0),d3.selectAll(".lab25to34").classed("ageSelector",!1)}),d3.select("#age25to34").on("click",function(e,t){var a=d3.select(this);a.classed("selected",!0),$(this).addClass("active"),d3.selectAll(".bar.malFocus").classed("malSelector",!0),d3.selectAll(".bar.femFocus").classed("femSelector",!0),d3.selectAll(".bar.malFocus.age25to34").classed("malSelector",!1),d3.selectAll(".bar.femFocus.age25to34").classed("femSelector",!1),d3.selectAll(".vis-axis").classed("noageSelector",!0),d3.selectAll(".vis-data-label").classed("noageSelector",!0),d3.selectAll(".lab25to34").classed("noageSelector",!1).classed("ageSelector",!0),d3.selectAll(".lab18to24").classed("ageSelector",!1)})})}(),$(document).ready(function(){function e(){var e=["ConfInt"],t=["Confidence Interval"];q.attr("class","vis-legend").attr("transform","translate("+(r-10*i.right)+",0)");var a=15;e.forEach(function(e,n){U=q.append("g").attr("class","legend-item-"+e).attr("transform","translate(0,"+n*a+")"),U.append("svg:line").attr("class","legend-item-"+e).attr("x1",133).attr("y1",37).attr("x2",150).attr("y2",37).style("stroke",X[n]).style("stroke-dasharray",K[n]).style("stroke-width",Q[n]),U.append("text").attr("class","legend-item-"+e).attr("x",40).attr("y",40).text(t[n])})}function t(e,t){e.each(function(){for(var e,a=d3.select(this),n=a.text().split(/\s+/).reverse(),r=[],o=0,s=1.1,i=a.attr("y"),l=parseFloat(a.attr("dy")),c=a.text(null).append("tspan").attr("x",0).attr("y",i).attr("dy",l+"em");e=n.pop();)r.push(e),c.text(r.join(" ")),c.node().getComputedTextLength()>t&&(r.pop(),c.text(r.join(" ")),r=[e],c=a.append("tspan").attr("x",0).attr("y",i).attr("dy",++o*s+l+"em").text(e))})}function a(){n(),q.attr("class","vis-legend").attr("transform","translate("+(r-10*i.right)+",0)"),b.rangeRoundBands([0,g.rangeBand()]),g.rangeRoundBands([0,r],.1),y.range([o,0]),E.scale(g),L.scale(y),W.attr("width",r+i.left+i.right).attr("height",o+i.top+i.bottom),P.attr("transform","translate(0,"+o+")").call(E).selectAll(".tick text").call(t,g.rangeBand()),I.call(L),j.attr("x",-o/2),V.attr("x",r-18),z.attr("x",r-24),R.attr("transform",function(e){return"translate("+(g(e.raceth)-10)+",0)"}),G.attr("width",b.rangeBand()).attr("x",function(e){return b(e.name)+10}).attr("y",function(e){return y(e.value)}).attr("value",function(e){return e.name}).attr("height",function(e){return o-y(e.value)}),A.x(function(e){return g("All")+b.rangeBand()/2}).y0(function(e){return y(x[0])}).y1(function(e){return y(w[0])}).interpolate("linear"),S.x(function(e){return g("All")+b.rangeBand()/2+b.rangeBand()}).y0(function(e){return y(k[0])}).y1(function(e){return y(N[0])}).interpolate("linear"),C.x(function(e){return g("White non-Hispanic")+b.rangeBand()/2}).y0(function(e){return y(x[1])}).y1(function(e){return y(w[1])}).interpolate("linear"),B.x(function(e){return g("White non-Hispanic")+b.rangeBand()/2+b.rangeBand()}).y0(function(e){return y(k[1])}).y1(function(e){return y(N[1])}).interpolate("linear"),T.x(function(e){return g("Black non-Hispanic")+b.rangeBand()/2}).y0(function(e){return y(x[2])}).y1(function(e){return y(w[2])}).interpolate("linear"),M.x(function(e){return g("Black non-Hispanic")+b.rangeBand()/2+b.rangeBand()}).y0(function(e){return y(k[2])}).y1(function(e){return y(N[2])}).interpolate("linear"),F.x(function(e){return g("Hispanic")+b.rangeBand()/2}).y0(function(e){return y(x[3])}).y1(function(e){return y(w[3])}).interpolate("linear"),_.x(function(e){return g("Hispanic")+b.rangeBand()/2+b.rangeBand()}).y0(function(e){return y(k[3])}).y1(function(e){return y(N[3])}).interpolate("linear"),c.attr("d",function(e){return A([e])}),d.attr("d",function(e){return S([e])}),u.attr("d",function(e){return C([e])}),p.attr("d",function(e){return B([e])}),h.attr("d",function(e){return T([e])}),m.attr("d",function(e){return M([e])}),f.attr("d",function(e){return F([e])}),v.attr("d",function(e){return _([e])})}function n(){var e=document.querySelector("#race_ethnicity_chart").clientWidth;i={top:50,right:10,bottom:60,left:50},r=e-i.left-i.right,e<500?(o=350-i.top-i.bottom,linemult=1.4,linepad=40):(o=500-i.top-i.bottom,linemult=1.35,linepad=30)}dataset=[{raceth:"All",2014:19.9,2015:23.3},{raceth:"White non-Hispanic",2014:23.3,2015:27.5},{raceth:"Black non-Hispanic",2014:11.1,2015:13.7},{raceth:"Hispanic",2014:15.3,2015:18.8}];var r,o,s=d3.scale.ordinal().range(["rgb(211, 211, 211)","#78909C"]),i={};n();var c,d,u,p,h,m,f,v,g=d3.scale.ordinal().rangeRoundBands([0,r],.1),b=d3.scale.ordinal().rangeBands([0,r],0),y=d3.scale.linear().range([o,0]),x=[18.8,22,5.5,12.4],w=[20.9,24.7,18.5,18.3],k=[22.2,26,7.4,15.7],N=[24.5,29,21.9,21.9],A=d3.svg.area(),S=d3.svg.area(),C=d3.svg.area(),B=d3.svg.area(),T=d3.svg.area(),M=d3.svg.area(),F=d3.svg.area(),_=d3.svg.area(),E=d3.svg.axis().scale(g).orient("bottom"),L=d3.svg.axis().scale(y).orient("left").tickFormat(d3.format(".0f")),O=d3.select("#race_ethnicity_chart").append("div").classed("vis-tooltip hidden",!0),W=d3.select("#race_ethnicity_chart").append("svg"),H=W.append("g").attr("transform","translate("+i.left+","+i.top+")"),D=d3.keys(dataset[0]).filter(function(e){return"raceth"!==e});dataset.forEach(function(e){e.values=D.map(function(t){return{name:t,value:+e[t]}})}),g.domain(dataset.map(function(e){return e.raceth})),b.domain(D).rangeRoundBands([0,g.rangeBand()]),y.domain([0,d3.max(dataset,function(e){return d3.max(e.values,function(e){return e.value})})]);var P=H.append("g").attr("class","vis-x-axis").attr("transform","translate(0,"+o+")"),I=H.append("g").attr("class","vis-y-axis"),j=I.append("text").attr("y",-35).attr("dy",".71em").attr("class","vis-y-axis-label").text("Age Adjusted Rates per 100,000"),R=H.selectAll(".bar").data(dataset).enter().append("g").attr("class","rect").attr("transform",function(e){return"translate("+(g(e.raceth)-10)+",0)"}),G=R.selectAll("rect").data(function(e){return e.values}).enter().append("rect");G.attr("width",b.rangeBand()).attr("x",function(e){return b(e.name)+5}).attr("y",function(e){return y(e.value)}).attr("value",function(e){return e.name}).attr("height",function(e){return o-y(e.value)}).style("fill",function(e){return s(e.name)}),R.on("mousemove",function(e){O.style("left",d3.event.pageX-$("#race_ethnicity_chart").offset().left+"px"),O.style("top",d3.event.pageY-$("#race_ethnicity_chart").offset().top+"px"),O.classed("hidden",!1);var t=(d3.event.pageX,d3.event.pageY,document.querySelectorAll(":hover"));l=t.length,l-=1,elementData=t[l].__data__,O.html("<rate>"+elementData.value+"</rate>")}),R.on("mouseout",function(e){O.classed("hidden",!0)});var Y=H.selectAll(".vis-legend").data(D.slice()).enter().append("g").attr("class","vis-legend").attr("transform",function(e,t){return"translate(0,"+20*t+")"}),V=Y.append("rect").attr("x",r-24).attr("width",18).attr("height",18).style("fill",s),z=Y.append("text").attr("x",r-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(e){return e}),q=W.append("g"),U=q.append("g"),X=["#0071bc"],Q=["1.5px"],K=["0,0,0,0"];A.x(function(e){return g("All")+b.rangeBand()/2}).y0(function(e){return y(x[0])}).y1(function(e){return y(w[0])}).interpolate("linear"),S.x(function(e){return g("All")+b.rangeBand()/2+b.rangeBand()}).y0(function(e){return y(k[0])}).y1(function(e){return y(N[0])}).interpolate("linear"),C.x(function(e){return g("White non-Hispanic")+b.rangeBand()/2}).y0(function(e){return y(x[1])}).y1(function(e){return y(w[1])}).interpolate("linear"),B.x(function(e){return g("White non-Hispanic")+b.rangeBand()/2+b.rangeBand()}).y0(function(e){return y(k[1])}).y1(function(e){return y(N[1])}).interpolate("linear"),T.x(function(e){return g("Black non-Hispanic")+b.rangeBand()/2}).y0(function(e){return y(x[2])}).y1(function(e){return y(w[2])}).interpolate("linear"),M.x(function(e){return g("Black non-Hispanic")+b.rangeBand()/2+b.rangeBand()}).y0(function(e){return y(k[2])}).y1(function(e){return y(N[2])}).interpolate("linear"),F.x(function(e){return g("Hispanic")+b.rangeBand()/2}).y0(function(e){return y(x[3])}).y1(function(e){return y(w[3])}).interpolate("linear"),_.x(function(e){return g("Hispanic")+b.rangeBand()/2+b.rangeBand()}).y0(function(e){return y(k[3])}).y1(function(e){return y(N[3])}).interpolate("linear"),c=H.append("g").selectAll("path").data(dataset),d=H.append("g").selectAll("path").data(dataset),u=H.append("g").selectAll("path").data(dataset),p=H.append("g").selectAll("path").data(dataset),h=H.append("g").selectAll("path").data(dataset),m=H.append("g").selectAll("path").data(dataset),f=H.append("g").selectAll("path").data(dataset),v=H.append("g").selectAll("path").data(dataset),c.enter().append("path"),d.enter().append("path"),u.enter().append("path"),p.enter().append("path"),h.enter().append("path"),m.enter().append("path"),f.enter().append("path"),v.enter().append("path"),c.attr("d",function(e){return A([e])}).attr("class","bars_race_error"),d.attr("d",function(e){return S([e])}).attr("class","bars_race_error"),u.attr("d",function(e){return C([e])}).attr("class","bars_race_error"),p.attr("d",function(e){return B([e])}).attr("class","bars_race_error"),h.attr("d",function(e){return T([e])}).attr("class","bars_race_error"),m.attr("d",function(e){return M([e])}).attr("class","bars_race_error"),f.attr("d",function(e){return F([e])}).attr("class","bars_race_error"),v.attr("d",function(e){return _([e])}).attr("class","bars_race_error"),a(),e(),window.addEventListener("resize",a)});var GLOBAL_STRINGS={PLAY:"Play",PAUSE:"Pause",TOGGLE_FULL_SCREEN:"Toggle full screen",MUTE:"Mute",RESTART:"Restart",CAPTIONS:"Closed captions",REWIND:"Rewind",FORWARD:"Forward"};new InitPxVideo({videoId:"drLukas",captionsOnDefault:!1,seekInterval:10,videoTitle:"Dr Lukas"}),new InitPxVideo({videoId:"governor",captionsOnDefault:!1,seekInterval:20,videoTitle:"Governor Baker"}),new InitPxVideo({videoId:"sarahWakeman",captionsOnDefault:!1,seekInterval:10,videoTitle:"Sarah Wakeman",debug:!0}),new InitPxVideo({videoId:"cotto",captionsOnDefault:!1,seekInterval:10,videoTitle:"Cotto"}),new InitPxVideo({videoId:"sue",captionsOnDefault:!1,seekInterval:10,videoTitle:"Sue"});
//# sourceMappingURL=main.js.map
